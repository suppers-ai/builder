import{d as f,w as c}from"./kK7WvOrX.js";import{a as r}from"./DjzGHUaI.js";import{g as i}from"./CKkZT4tm.js";function k(){const{subscribe:u,set:l,update:n}=c({user:null,loading:!1,error:null});return{subscribe:u,async login(e,t){n(o=>({...o,loading:!0,error:null}));try{const o=await r.post("/api/auth/login",{email:e,password:t});r.setToken(o.token),localStorage.setItem("token",o.token),s.set(o.token),l({user:o.user,loading:!1,error:null}),i("/")}catch(o){n(a=>({...a,loading:!1,error:o instanceof Error?o.message:"Login failed"}))}},async register(e,t,o){n(a=>({...a,loading:!0,error:null}));try{const a=await r.post("/api/auth/register",{email:e,password:t,name:o});r.setToken(a.token),localStorage.setItem("token",a.token),s.set(a.token),l({user:a.user,loading:!1,error:null}),i("/")}catch(a){n(d=>({...d,loading:!1,error:a instanceof Error?a.message:"Registration failed"}))}},async logout(){try{await r.post("/api/auth/logout")}catch{}r.setToken(null),localStorage.removeItem("token"),s.set(null),document.cookie="auth-token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT",l({user:null,loading:!1,error:null}),i("/auth/login")},async checkAuth(){const e=localStorage.getItem("token");if(!e){l({user:null,loading:!1,error:null});return}r.setToken(e),n(t=>({...t,loading:!0}));try{const t=await r.get("/api/auth/me");l({user:t,loading:!1,error:null}),s.set(e)}catch{r.setToken(null),localStorage.removeItem("token"),s.set(null),l({user:null,loading:!1,error:null})}},setToken(e){e?(r.setToken(e),localStorage.setItem("token",e),s.set(e)):(r.setToken(null),localStorage.removeItem("token"),s.set(null))},async updateProfile(e){n(t=>({...t,loading:!0,error:null}));try{const t=await r.put("/api/auth/profile",e);l({user:t,loading:!1,error:null})}catch(t){n(o=>({...o,loading:!1,error:t instanceof Error?t.message:"Update failed"}))}}}}const p=k();f(p,u=>!!u.user);let g=null;typeof window<"u"&&(g=localStorage.getItem("token"));const s=c(g);export{p as a,s as t};
