import{q as W,a9 as X,aa as Y,ab as Z,ac as ee,ad as te,S as T,i as k,s as A,A as $,a as U,t as F,b as R,m as E,l as L,p as O,B as v,C,D,E as M,F as q,ae as V,O as se,af as _}from"./D7cgMQgG.js";import{g as N,a as Q}from"./ClgeGvnK.js";import"./IHki7fMi.js";import{I as z}from"./DsNLi6AI.js";import{w as H,d as p}from"./kK7WvOrX.js";import{g as re}from"./CKkZT4tm.js";import{t as ae,a as J}from"./BTKmAHds.js";import{n as f}from"./DtGtgTaB.js";const ne=!0;function Oe(i,e,t,s){if(!e)return W;const r=i.getBoundingClientRect();if(e.left===r.left&&e.right===r.right&&e.top===r.top&&e.bottom===r.bottom)return W;const{delay:a=0,duration:n=300,easing:o=X,start:c=Y()+a,end:d=c+n,tick:u=W,css:g}=t(i,{from:e,to:r},s);let w=!0,m=!1,b;function S(){g&&(b=ee(i,0,1,n,a,o,g)),a||(m=!0)}function I(){g&&te(i,b),w=!1}return Z(h=>{if(!m&&h>=c&&(m=!0),m&&h>=d&&(u(1,0),I()),!w)return!1;if(m){const x=h-c,j=0+1*o(x/n);u(j,1-j)}return!0}),S(),u(0,1),I}function Ce(i){const e=getComputedStyle(i);if(e.position!=="absolute"&&e.position!=="fixed"){const{width:t,height:s}=e,r=i.getBoundingClientRect();i.style.position="absolute",i.style.width=t,i.style.height=s,ie(i,r)}}function ie(i,e){const t=i.getBoundingClientRect();if(e.left!==t.left||e.top!==t.top){const s=getComputedStyle(i),r=s.transform==="none"?"":s.transform;i.style.transform=`${r} translate(${e.left-t.left}px, ${e.top-t.top}px)`}}const oe=ne;function le(i){let e;const t=i[2].default,s=C(t,i,i[3],null);return{c(){s&&s.c()},l(r){s&&s.l(r)},m(r,a){s&&s.m(r,a),e=!0},p(r,a){s&&s.p&&(!e||a&8)&&D(s,t,r,r[3],e?q(t,r[3],a,null):M(r[3]),null)},i(r){e||(R(s,r),e=!0)},o(r){F(s,r),e=!1},d(r){s&&s.d(r)}}}function ce(i){let e,t;const s=[{name:"circle-check-big"},i[1],{iconNode:i[0]}];let r={$$slots:{default:[le]},$$scope:{ctx:i}};for(let a=0;a<s.length;a+=1)r=$(r,s[a]);return e=new z({props:r}),{c(){O(e.$$.fragment)},l(a){L(e.$$.fragment,a)},m(a,n){E(e,a,n),t=!0},p(a,[n]){const o=n&3?N(s,[s[0],n&2&&Q(a[1]),n&1&&{iconNode:a[0]}]):{};n&8&&(o.$$scope={dirty:n,ctx:a}),e.$set(o)},i(a){t||(R(e.$$.fragment,a),t=!0)},o(a){F(e.$$.fragment,a),t=!1},d(a){U(e,a)}}}function de(i,e,t){let{$$slots:s={},$$scope:r}=e;const a=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335"}],["path",{d:"m9 11 3 3L22 4"}]];return i.$$set=n=>{t(1,e=$($({},e),v(n))),"$$scope"in n&&t(3,r=n.$$scope)},e=v(e),[a,e,s,r]}class De extends T{constructor(e){super(),k(this,e,de,ce,A,{})}}function ue(i){let e;const t=i[2].default,s=C(t,i,i[3],null);return{c(){s&&s.c()},l(r){s&&s.l(r)},m(r,a){s&&s.m(r,a),e=!0},p(r,a){s&&s.p&&(!e||a&8)&&D(s,t,r,r[3],e?q(t,r[3],a,null):M(r[3]),null)},i(r){e||(R(s,r),e=!0)},o(r){F(s,r),e=!1},d(r){s&&s.d(r)}}}function he(i){let e,t;const s=[{name:"copy"},i[1],{iconNode:i[0]}];let r={$$slots:{default:[ue]},$$scope:{ctx:i}};for(let a=0;a<s.length;a+=1)r=$(r,s[a]);return e=new z({props:r}),{c(){O(e.$$.fragment)},l(a){L(e.$$.fragment,a)},m(a,n){E(e,a,n),t=!0},p(a,[n]){const o=n&3?N(s,[s[0],n&2&&Q(a[1]),n&1&&{iconNode:a[0]}]):{};n&8&&(o.$$scope={dirty:n,ctx:a}),e.$set(o)},i(a){t||(R(e.$$.fragment,a),t=!0)},o(a){F(e.$$.fragment,a),t=!1},d(a){U(e,a)}}}function fe(i,e,t){let{$$slots:s={},$$scope:r}=e;const a=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"}]];return i.$$set=n=>{t(1,e=$($({},e),v(n))),"$$scope"in n&&t(3,r=n.$$scope)},e=v(e),[a,e,s,r]}class Me extends T{constructor(e){super(),k(this,e,fe,he,A,{})}}function me(i){let e;const t=i[2].default,s=C(t,i,i[3],null);return{c(){s&&s.c()},l(r){s&&s.l(r)},m(r,a){s&&s.m(r,a),e=!0},p(r,a){s&&s.p&&(!e||a&8)&&D(s,t,r,r[3],e?q(t,r[3],a,null):M(r[3]),null)},i(r){e||(R(s,r),e=!0)},o(r){F(s,r),e=!1},d(r){s&&s.d(r)}}}function pe(i){let e,t;const s=[{name:"move"},i[1],{iconNode:i[0]}];let r={$$slots:{default:[me]},$$scope:{ctx:i}};for(let a=0;a<s.length;a+=1)r=$(r,s[a]);return e=new z({props:r}),{c(){O(e.$$.fragment)},l(a){L(e.$$.fragment,a)},m(a,n){E(e,a,n),t=!0},p(a,[n]){const o=n&3?N(s,[s[0],n&2&&Q(a[1]),n&1&&{iconNode:a[0]}]):{};n&8&&(o.$$scope={dirty:n,ctx:a}),e.$set(o)},i(a){t||(R(e.$$.fragment,a),t=!0)},o(a){F(e.$$.fragment,a),t=!1},d(a){U(e,a)}}}function ge(i,e,t){let{$$slots:s={},$$scope:r}=e;const a=[["path",{d:"M12 2v20"}],["path",{d:"m15 19-3 3-3-3"}],["path",{d:"m19 9 3 3-3 3"}],["path",{d:"M2 12h20"}],["path",{d:"m5 9-3 3 3 3"}],["path",{d:"m9 5 3-3 3 3"}]];return i.$$set=n=>{t(1,e=$($({},e),v(n))),"$$scope"in n&&t(3,r=n.$$scope)},e=v(e),[a,e,s,r]}class qe extends T{constructor(e){super(),k(this,e,ge,pe,A,{})}}function ye(i){let e;const t=i[2].default,s=C(t,i,i[3],null);return{c(){s&&s.c()},l(r){s&&s.l(r)},m(r,a){s&&s.m(r,a),e=!0},p(r,a){s&&s.p&&(!e||a&8)&&D(s,t,r,r[3],e?q(t,r[3],a,null):M(r[3]),null)},i(r){e||(R(s,r),e=!0)},o(r){F(s,r),e=!1},d(r){s&&s.d(r)}}}function $e(i){let e,t;const s=[{name:"square-pen"},i[1],{iconNode:i[0]}];let r={$$slots:{default:[ye]},$$scope:{ctx:i}};for(let a=0;a<s.length;a+=1)r=$(r,s[a]);return e=new z({props:r}),{c(){O(e.$$.fragment)},l(a){L(e.$$.fragment,a)},m(a,n){E(e,a,n),t=!0},p(a,[n]){const o=n&3?N(s,[s[0],n&2&&Q(a[1]),n&1&&{iconNode:a[0]}]):{};n&8&&(o.$$scope={dirty:n,ctx:a}),e.$set(o)},i(a){t||(R(e.$$.fragment,a),t=!0)},o(a){F(e.$$.fragment,a),t=!1},d(a){U(e,a)}}}function we(i,e,t){let{$$slots:s={},$$scope:r}=e;const a=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z"}]];return i.$$set=n=>{t(1,e=$($({},e),v(n))),"$$scope"in n&&t(3,r=n.$$scope)},e=v(e),[a,e,s,r]}class Ne extends T{constructor(e){super(),k(this,e,we,$e,A,{})}}function B(i){const e=i-1;return e*e*e+1}function Qe(i,{delay:e=0,duration:t=400,easing:s=X}={}){const r=+getComputedStyle(i).opacity;return{delay:e,duration:t,easing:s,css:a=>`opacity: ${a*r}`}}function ze(i,{delay:e=0,duration:t=400,easing:s=B,x:r=0,y:a=0,opacity:n=0}={}){const o=getComputedStyle(i),c=+o.opacity,d=o.transform==="none"?"":o.transform,u=c*(1-n),[g,w]=V(r),[m,b]=V(a);return{delay:e,duration:t,easing:s,css:(S,I)=>`
			transform: ${d} translate(${(1-S)*g}${w}, ${(1-S)*m}${b});
			opacity: ${c-u*I}`}}function Be(i,{delay:e=0,duration:t=400,easing:s=B,axis:r="y"}={}){const a=getComputedStyle(i),n=+a.opacity,o=r==="y"?"height":"width",c=parseFloat(a[o]),d=r==="y"?["top","bottom"]:["left","right"],u=d.map(h=>`${h[0].toUpperCase()}${h.slice(1)}`),g=parseFloat(a[`padding${u[0]}`]),w=parseFloat(a[`padding${u[1]}`]),m=parseFloat(a[`margin${u[0]}`]),b=parseFloat(a[`margin${u[1]}`]),S=parseFloat(a[`border${u[0]}Width`]),I=parseFloat(a[`border${u[1]}Width`]);return{delay:e,duration:t,easing:s,css:h=>`overflow: hidden;opacity: ${Math.min(h*20,1)*n};${o}: ${h*c}px;padding-${d[0]}: ${h*g}px;padding-${d[1]}: ${h*w}px;margin-${d[0]}: ${h*m}px;margin-${d[1]}: ${h*b}px;border-${d[0]}-width: ${h*S}px;border-${d[1]}-width: ${h*I}px;`}}function xe(i,{delay:e=0,duration:t=400,easing:s=B,start:r=0,opacity:a=0}={}){const n=getComputedStyle(i),o=+n.opacity,c=n.transform==="none"?"":n.transform,d=1-r,u=o*(1-a);return{delay:e,duration:t,easing:s,css:(g,w)=>`
			transform: ${c} scale(${1-d*w});
			opacity: ${o-u*w}
		`}}function We(i,{from:e,to:t},s={}){const r=getComputedStyle(i),a=r.transform==="none"?"":r.transform,[n,o]=r.transformOrigin.split(" ").map(parseFloat),c=e.left+e.width*n/t.width-(t.left+n),d=e.top+e.height*o/t.height-(t.top+o),{delay:u=0,duration:g=m=>Math.sqrt(m)*120,easing:w=B}=s;return{delay:u,duration:se(g)?g(Math.sqrt(c*c+d*d)):g,easing:w,css:(m,b)=>{const S=b*c,I=b*d,h=m+b*e.width/t.width,x=m+b*e.height/t.height;return`transform: ${a} translate(${S}px, ${I}px) scale(${h}, ${x});`}}}class y extends Error{constructor(e,t,s,r){super(e),this.name="ApiError",this.status=t,this.code=s,this.details=r}}class be{constructor(e){this.authToken=null,this.refreshPromise=null,this.config={baseURL:(e==null?void 0:e.baseURL)||void 0||"",timeout:(e==null?void 0:e.timeout)||3e4,headers:{"Content-Type":"application/json",...e==null?void 0:e.headers}},ae.subscribe(t=>{this.authToken=t})}setAuthToken(e){this.authToken=e}buildURL(e){return e.startsWith("http")?e:`${this.config.baseURL}${e}`}buildHeaders(e){const t={...this.config.headers,...e};return this.authToken&&(t.Authorization=`Bearer ${this.authToken}`),t}async handleError(e){let t="An error occurred",s,r;try{const a=await e.json();t=a.message||a.error||t,s=a.code,r=a.details}catch{t=e.statusText||t}switch(e.status){case 401:if(this.authToken&&!this.refreshPromise){this.refreshPromise=this.refreshToken();const a=await this.refreshPromise;if(this.refreshPromise=null,a)throw new y("Token refreshed, retry request",401,"TOKEN_REFRESHED")}J.logout(),re("/auth/login");break;case 403:t="You do not have permission to perform this action";break;case 404:t="The requested resource was not found";break;case 429:t="Too many requests. Please try again later";break;case 500:case 502:case 503:t="Server error. Please try again later";break}return new y(t,e.status,s,r)}async refreshToken(){try{const e=await fetch(this.buildURL("/api/auth/refresh"),{method:"POST",credentials:"include",headers:this.buildHeaders()});if(e.ok){const t=await e.json();if(t.token)return J.setToken(t.token),!0}}catch(e){console.error("Token refresh failed:",e)}return!1}async request(e,t,s){const r=new URL(this.buildURL(t));s!=null&&s.params&&Object.entries(s.params).forEach(([o,c])=>{c!=null&&r.searchParams.append(o,String(c))});const a=new AbortController,n=setTimeout(()=>a.abort(),(s==null?void 0:s.timeout)||this.config.timeout);try{const o=await fetch(r.toString(),{method:e,headers:this.buildHeaders(s==null?void 0:s.headers),body:s!=null&&s.body?JSON.stringify(s.body):void 0,signal:a.signal,credentials:"include"});if(clearTimeout(n),!o.ok){const u=await this.handleError(o);if(u.code==="TOKEN_REFRESHED"&&(!(s!=null&&s.retry)||s.retry<1))return this.request(e,t,{...s,retry:((s==null?void 0:s.retry)||0)+1});throw u}const c=o.headers.get("content-type");let d;return c!=null&&c.includes("application/json")?d=await o.json():o.status!==204&&(d=await o.text()),{data:d,status:o.status,success:!0}}catch(o){throw clearTimeout(n),o.name==="AbortError"?new y("Request timeout",408,"TIMEOUT"):window.navigator.onLine?o instanceof y?o:new y(o.message||"An unexpected error occurred",0,"UNKNOWN",o):new y("No internet connection",0,"OFFLINE")}}async get(e,t){return(await this.request("GET",e,{params:t})).data}async post(e,t,s){return(await this.request("POST",e,{body:t,...s})).data}async put(e,t,s){return(await this.request("PUT",e,{body:t,...s})).data}async patch(e,t,s){return(await this.request("PATCH",e,{body:t,...s})).data}async delete(e,t){return(await this.request("DELETE",e,t)).data}async upload(e,t,s){const r=new FormData;return r.append("file",t),s!=null&&s.additionalData&&Object.entries(s.additionalData).forEach(([a,n])=>{r.append(a,String(n))}),new Promise((a,n)=>{const o=new XMLHttpRequest;s!=null&&s.onProgress&&o.upload.addEventListener("progress",c=>{if(c.lengthComputable){const d=c.loaded/c.total*100;s.onProgress(d)}}),o.addEventListener("load",()=>{if(o.status>=200&&o.status<300)try{const c=JSON.parse(o.responseText);a(c)}catch{a(o.responseText)}else n(new y("Upload failed",o.status,"UPLOAD_ERROR"))}),o.addEventListener("error",()=>{n(new y("Upload failed",0,"NETWORK_ERROR"))}),o.addEventListener("abort",()=>{n(new y("Upload cancelled",0,"ABORTED"))}),o.open("POST",this.buildURL(e)),this.authToken&&o.setRequestHeader("Authorization",`Bearer ${this.authToken}`),o.send(r)})}async download(e,t){return new Promise((s,r)=>{const a=new XMLHttpRequest;a.responseType="blob",t!=null&&t.onProgress&&a.addEventListener("progress",n=>{if(n.lengthComputable){const o=n.loaded/n.total*100;t.onProgress(o)}}),a.addEventListener("load",()=>{if(a.status>=200&&a.status<300){const n=a.response;if(t!=null&&t.filename&&oe){const o=URL.createObjectURL(n),c=document.createElement("a");c.href=o,c.download=t.filename,c.click(),URL.revokeObjectURL(o)}s(n)}else r(new y("Download failed",a.status,"DOWNLOAD_ERROR"))}),a.addEventListener("error",()=>{r(new y("Download failed",0,"NETWORK_ERROR"))}),a.addEventListener("abort",()=>{r(new y("Download cancelled",0,"ABORTED"))}),a.open("GET",this.buildURL(e)),this.authToken&&a.setRequestHeader("Authorization",`Bearer ${this.authToken}`),a.send()})}}const l=new be;class Pe{constructor(){this.basePath="/api/storage"}async listFiles(e={}){return l.get(`${this.basePath}/files`,e)}async getItem(e){return l.get(`${this.basePath}/files/${e}`)}async uploadFile(e,t={}){return await l.upload(`${this.basePath}/upload`,e,{onProgress:t.onProgress,additionalData:{path:t.path||"/",parentId:t.parentId,...t.metadata}})}async uploadFiles(e,t={}){const s=e.map(r=>this.uploadFile(r,t));return Promise.all(s)}async downloadFile(e,t){return l.download(`${this.basePath}/files/${e}/download`,t)}async downloadMultiple(e,t){const{archiveId:s}=await l.post(`${this.basePath}/archive`,{fileIds:e});return l.download(`${this.basePath}/archive/${s}/download`,t)}async deleteItem(e,t=!1){await l.delete(`${this.basePath}/files/${e}`,{params:{permanent:t}})}async deleteMultiple(e,t=!1){await l.post(`${this.basePath}/files/batch/delete`,{ids:e,permanent:t})}async rename(e,t){return l.patch(`${this.basePath}/files/${e}`,{name:t})}async move(e,t){return l.post(`${this.basePath}/files/${e}/move`,t)}async moveMultiple(e,t){return l.post(`${this.basePath}/files/batch/move`,{ids:e,...t})}async copy(e,t){return l.post(`${this.basePath}/files/${e}/copy`,t)}async copyMultiple(e,t){return l.post(`${this.basePath}/files/batch/copy`,{ids:e,...t})}async createFolder(e,t="/",s){return l.post(`${this.basePath}/folders`,{name:e,path:t,parentId:s})}getPreviewUrl(e,t){const s=new URLSearchParams;t!=null&&t.width&&s.append("w",String(t.width)),t!=null&&t.height&&s.append("h",String(t.height));const r="http://localhost:8080",a=s.toString();return`${r}${this.basePath}/files/${e}/preview${a?`?${a}`:""}`}getThumbnailUrl(e,t="md"){const s={sm:64,md:128,lg:256};return this.getPreviewUrl(e,{width:s[t],height:s[t]})}async search(e,t){const s={q:e,...t};return t!=null&&t.dateFrom&&(s.dateFrom=t.dateFrom.toISOString()),t!=null&&t.dateTo&&(s.dateTo=t.dateTo.toISOString()),l.get(`${this.basePath}/search`,s)}async getQuota(){return l.get(`${this.basePath}/quota`)}async getStats(){return l.get(`${this.basePath}/stats`)}async getTrash(e){return l.get(`${this.basePath}/trash`,e)}async restore(e){return l.post(`${this.basePath}/trash/${e}/restore`)}async emptyTrash(){await l.delete(`${this.basePath}/trash`)}async lockFile(e){await l.post(`${this.basePath}/files/${e}/lock`)}async unlockFile(e){await l.delete(`${this.basePath}/files/${e}/lock`)}async getVersions(e){return l.get(`${this.basePath}/files/${e}/versions`)}async restoreVersion(e,t){return l.post(`${this.basePath}/files/${e}/versions/${t}/restore`)}async getActivity(e,t){return l.get(`${this.basePath}/files/${e}/activity`,t)}async updateMetadata(e,t){return l.patch(`${this.basePath}/files/${e}/metadata`,t)}async addTags(e,t){await l.post(`${this.basePath}/files/${e}/tags`,{tags:t})}async removeTags(e,t){await l.delete(`${this.basePath}/files/${e}/tags`,{body:{tags:t}})}async getPopularTags(e=20){return l.get(`${this.basePath}/tags/popular`,{limit:e})}async convertFile(e,t){return l.post(`${this.basePath}/files/${e}/convert`,t)}async extractArchive(e,t){return l.post(`${this.basePath}/files/${e}/extract`,{targetPath:t})}async createArchive(e,t){return l.post(`${this.basePath}/archive`,{fileIds:e,...t})}async scanFile(e){return l.post(`${this.basePath}/files/${e}/scan`)}}const P=new Pe;class _e{constructor(){this.basePath="/api/sharing"}async createShareLink(e){return l.post(`${this.basePath}/links`,e)}async getShareLink(e){return l.get(`${this.basePath}/links/${e}`)}async listShareLinks(e){return l.get(`${this.basePath}/links`,e)}async updateShareLink(e,t){return l.patch(`${this.basePath}/links/${e}`,t)}async revokeShareLink(e){await l.delete(`${this.basePath}/links/${e}`)}async shareWithUsers(e){return l.post(`${this.basePath}/users`,e)}async getUserShare(e){return l.get(`${this.basePath}/users/${e}`)}async listUserShares(e){return l.get(`${this.basePath}/users`,e)}async updateUserShare(e,t){return l.patch(`${this.basePath}/users/${e}`,{permissions:t})}async removeUserShare(e){await l.delete(`${this.basePath}/users/${e}`)}async getSharedWithMe(e){return l.get(`${this.basePath}/with-me`,e)}async getMyShares(e){return l.get(`${this.basePath}/my-shares`,e)}async acceptShare(e){await l.post(`${this.basePath}/users/${e}/accept`)}async declineShare(e){await l.post(`${this.basePath}/users/${e}/decline`)}async getAccessLogs(e,t){return l.get(`${this.basePath}/logs/${e}`,t)}async verifyPassword(e,t){return l.post(`${this.basePath}/links/${e}/verify`,{password:t})}async accessSharedItem(e,t){return l.post(`${this.basePath}/links/${e}/access`,{password:t})}async downloadSharedFile(e,t){return t!=null&&t.password&&await this.verifyPassword(e,t.password),l.download(`${this.basePath}/links/${e}/download`,{onProgress:t==null?void 0:t.onProgress})}async uploadToSharedFolder(e,t,s){return s!=null&&s.password&&await this.verifyPassword(e,s.password),l.upload(`${this.basePath}/links/${e}/upload`,t,{onProgress:s==null?void 0:s.onProgress})}async getShareStats(e){return l.get(`${this.basePath}/links/${e}/stats`)}async sendNotification(e,t){await l.post(`${this.basePath}/notify`,{shareId:e,...t})}getEmbedCode(e,t){const s=new URLSearchParams;return t!=null&&t.width&&s.append("width",String(t.width)),t!=null&&t.height&&s.append("height",String(t.height)),t!=null&&t.theme&&s.append("theme",t.theme),(t==null?void 0:t.showDownload)!==void 0&&s.append("download",String(t.showDownload)),`<iframe src="${`${window.location.origin}/embed/${e}?${s.toString()}`}" width="${(t==null?void 0:t.width)||640}" height="${(t==null?void 0:t.height)||480}" frameborder="0" allowfullscreen></iframe>`}getQRCodeUrl(e,t=256){return`http://localhost:8080${this.basePath}/links/${e}/qr?size=${t}`}async transferOwnership(e,t){await l.post(`${this.basePath}/users/${e}/transfer`,{newOwnerId:t})}async bulkShare(e,t){return l.post(`${this.basePath}/bulk`,{itemIds:e,...t})}}const K=new _e;class Se{constructor(){this.recentItems=H([]),this.starredItems=H([]),this.maxRecentItems=50,this.recentItems$={subscribe:this.recentItems.subscribe},this.starredItems$={subscribe:this.starredItems.subscribe},this.recentFiles$=p(this.recentItems,e=>e.filter(t=>t.item.type==="file")),this.recentFolders$=p(this.recentItems,e=>e.filter(t=>t.item.type==="folder")),this.starredFiles$=p(this.starredItems,e=>e.filter(t=>t.item.type==="file")),this.starredFolders$=p(this.starredItems,e=>e.filter(t=>t.item.type==="folder")),this.mostAccessed$=p(this.recentItems,e=>[...e].sort((t,s)=>s.accessCount-t.accessCount).slice(0,10)),this.loadFromStorage(),this.recentItems.subscribe(e=>{this.saveToStorage("recentItems",e)}),this.starredItems.subscribe(e=>{this.saveToStorage("starredItems",e)})}trackAccess(e,t="view"){this.recentItems.update(s=>{const r=s.findIndex(a=>a.item.id===e.id);if(r>=0){const a=s[r];s[r]={...a,accessedAt:new Date,accessType:t,accessCount:a.accessCount+1},s.unshift(s.splice(r,1)[0])}else s.unshift({item:e,accessedAt:new Date,accessType:t,accessCount:1});return s.slice(0,this.maxRecentItems)})}toggleStar(e,t){let s=!1;return this.starredItems.update(r=>{const a=r.findIndex(n=>n.item.id===e.id);return a>=0?(r.splice(a,1),s=!1):(r.unshift({item:e,starredAt:new Date,notes:t}),s=!0),r}),s}isStarred(e){return _(this.starredItems).some(s=>s.item.id===e)}updateStarNotes(e,t){this.starredItems.update(s=>{const r=s.find(a=>a.item.id===e);return r&&(r.notes=t),s})}clearRecent(){this.recentItems.set([])}clearStarred(){this.starredItems.set([])}removeRecent(e){this.recentItems.update(t=>t.filter(s=>s.item.id!==e))}getRecentByType(e){return _(this.recentItems).filter(s=>s.accessType===e)}getRecentInRange(e,t){return _(this.recentItems).filter(r=>r.accessedAt>=e&&r.accessedAt<=t)}loadFromStorage(){if(!(typeof localStorage>"u"))try{const e=localStorage.getItem("recentItems");if(e){const s=JSON.parse(e);s.forEach(r=>{r.accessedAt=new Date(r.accessedAt),r.item.createdAt&&(r.item.createdAt=new Date(r.item.createdAt)),r.item.modifiedAt&&(r.item.modifiedAt=new Date(r.item.modifiedAt))}),this.recentItems.set(s)}const t=localStorage.getItem("starredItems");if(t){const s=JSON.parse(t);s.forEach(r=>{r.starredAt=new Date(r.starredAt),r.item.createdAt&&(r.item.createdAt=new Date(r.item.createdAt)),r.item.modifiedAt&&(r.item.modifiedAt=new Date(r.item.modifiedAt))}),this.starredItems.set(s)}}catch(e){console.error("Failed to load recent/starred items:",e)}}saveToStorage(e,t){if(!(typeof localStorage>"u"))try{localStorage.setItem(e,JSON.stringify(t))}catch(s){console.error(`Failed to save ${e}:`,s)}}exportRecentActivity(){const e=_(this.recentItems),t=["Name","Type","Access Type","Access Count","Last Accessed"],s=e.map(r=>[r.item.name,r.item.type,r.accessType,r.accessCount.toString(),r.accessedAt.toLocaleString()]);return[t,...s].map(r=>r.map(a=>`"${a}"`).join(",")).join(`
`)}}const G=new Se;class Ie{constructor(){this.store=H({files:[],folders:[],currentPath:"/",selectedItems:[],searchQuery:"",sortBy:"name",sortOrder:"asc",viewMode:"grid",filters:{},quota:null,uploadQueue:[],loading:!1,error:null}),this.subscribe=this.store.subscribe,this.files$=p(this.store,e=>e.files),this.folders$=p(this.store,e=>e.folders),this.currentPath$=p(this.store,e=>e.currentPath),this.selectedItems$=p(this.store,e=>e.selectedItems),this.uploadQueue$=p(this.store,e=>e.uploadQueue),this.quota$=p(this.store,e=>e.quota),this.loading$=p(this.store,e=>e.loading),this.viewMode$=p(this.store,e=>e.viewMode),this.filteredFiles$=p(this.store,e=>{let t=[...e.files,...e.folders];if(e.searchQuery){const s=e.searchQuery.toLowerCase();t=t.filter(r=>r.name.toLowerCase().includes(s))}if(e.filters.type&&e.filters.type!=="all"&&(t=t.filter(s=>{if(e.filters.type==="folder")return s.type==="folder";if(e.filters.type==="file")return s.type==="file";if(s.type==="file"){const r=s.mimeType;switch(e.filters.type){case"image":return r.startsWith("image/");case"document":return r.includes("document")||r.includes("pdf");case"video":return r.startsWith("video/");case"audio":return r.startsWith("audio/")}}return!1})),e.filters.dateRange){const{from:s,to:r}=e.filters.dateRange;t=t.filter(a=>{const n=a.modifiedAt;return!(s&&n<s||r&&n>r)})}if(e.filters.sizeRange){const{min:s,max:r}=e.filters.sizeRange;t=t.filter(a=>{if(a.type!=="file")return!0;const n=a.size;return!(s&&n<s||r&&n>r)})}return t.sort((s,r)=>{let a=0;switch(e.sortBy){case"name":a=s.name.localeCompare(r.name);break;case"size":const n=s.type==="file"?s.size:0,o=r.type==="file"?r.size:0;a=n-o;break;case"date":a=s.modifiedAt.getTime()-r.modifiedAt.getTime();break;case"type":s.type!==r.type?a=s.type==="folder"?-1:1:s.type==="file"&&(a=s.mimeType.localeCompare(r.mimeType));break}return e.sortOrder==="asc"?a:-a}),t})}async loadFiles(e){const t=e||_(this.store).currentPath;this.store.update(s=>({...s,loading:!0,error:null,currentPath:t}));try{const s=await P.listFiles({path:t,sortBy:_(this.store).sortBy,sortOrder:_(this.store).sortOrder}),r=s.items.filter(n=>n.type==="file"),a=s.items.filter(n=>n.type==="folder");this.store.update(n=>({...n,files:r,folders:a,loading:!1}))}catch(s){this.store.update(r=>({...r,loading:!1,error:s.message})),f.error("Failed to load files",s.message)}}async uploadFiles(e,t){const s=t||_(this.store).currentPath,r=e.map(a=>({id:Math.random().toString(36).substr(2,9),file:a,path:s,progress:0,status:"pending"}));this.store.update(a=>({...a,uploadQueue:[...a.uploadQueue,...r]}));for(const a of r)await this.processUpload(a);await this.loadFiles()}async processUpload(e){try{this.updateUploadItem(e.id,{status:"uploading",progress:0});const t=await P.uploadFile(e.file,{path:e.path,onProgress:s=>{this.updateUploadItem(e.id,{progress:s})}});this.updateUploadItem(e.id,{status:"completed",progress:100,uploadedFile:t}),G.trackAccess(t,"edit"),f.success(`Uploaded ${e.file.name}`)}catch(t){this.updateUploadItem(e.id,{status:"error",error:t.message}),f.error(`Failed to upload ${e.file.name}`,t.message)}}updateUploadItem(e,t){this.store.update(s=>({...s,uploadQueue:s.uploadQueue.map(r=>r.id===e?{...r,...t}:r)}))}async deleteItem(e){try{return await P.deleteItem(e),this.store.update(t=>({...t,files:t.files.filter(s=>s.id!==e),folders:t.folders.filter(s=>s.id!==e),selectedItems:t.selectedItems.filter(s=>s!==e)})),f.success("Item deleted"),!0}catch(t){return f.error("Failed to delete item",t.message),!1}}async deleteItems(e){try{return await P.deleteMultiple(e),this.store.update(t=>({...t,files:t.files.filter(s=>!e.includes(s.id)),folders:t.folders.filter(s=>!e.includes(s.id)),selectedItems:[]})),f.success(`${e.length} items deleted`),!0}catch(t){return f.error("Failed to delete items",t.message),!1}}async createFolder(e,t){const s=t||_(this.store).currentPath;try{const r=await P.createFolder(e,s);return this.store.update(a=>({...a,folders:[...a.folders,r]})),f.success(`Folder "${e}" created`),!0}catch(r){return f.error("Failed to create folder",r.message),!1}}async renameItem(e,t){try{const s=await P.rename(e,t);return this.store.update(r=>s.type==="file"?{...r,files:r.files.map(a=>a.id===e?s:a)}:{...r,folders:r.folders.map(a=>a.id===e?s:a)}),f.success("Renamed successfully"),!0}catch(s){return f.error("Failed to rename",s.message),!1}}async moveItems(e,t){try{return await P.moveMultiple(e,{targetPath:t}),this.store.update(s=>({...s,files:s.files.filter(r=>!e.includes(r.id)),folders:s.folders.filter(r=>!e.includes(r.id)),selectedItems:[]})),f.success(`${e.length} items moved`),!0}catch(s){return f.error("Failed to move items",s.message),!1}}async copyItems(e,t){try{const s=await P.copyMultiple(e,{targetPath:t});if(t===_(this.store).currentPath){const r=s.filter(n=>n.type==="file"),a=s.filter(n=>n.type==="folder");this.store.update(n=>({...n,files:[...n.files,...r],folders:[...n.folders,...a]}))}return f.success(`${e.length} items copied`),!0}catch(s){return f.error("Failed to copy items",s.message),!1}}async downloadFile(e){try{const t=_(this.store).files.find(r=>r.id===e);if(!t)throw new Error("File not found");const s=await P.downloadFile(e,{onProgress:r=>{}});return G.trackAccess(t,"download"),{success:!0,blob:s,filename:t.name}}catch(t){return{success:!1,error:t.message}}}async downloadFiles(e){try{return{success:!0,blob:await P.downloadMultiple(e,{onProgress:s=>{}}),filename:`download-${Date.now()}.zip`}}catch(t){return{success:!1,error:t.message}}}async createShare(e,t){try{const s=await K.createShareLink({itemId:e,...t});return{success:!0,url:s.url,shareId:s.shareId}}catch(s){return{success:!1,error:s.message}}}async shareWithUsers(e,t,s){try{return await K.shareWithUsers({itemId:e,users:t,permissions:s,sendEmail:!0}),f.success(`Shared with ${t.length} users`),!0}catch(r){return f.error("Failed to share",r.message),!1}}async loadQuota(){try{const e=await P.getQuota();this.store.update(t=>({...t,quota:e}))}catch(e){console.error("Failed to load quota:",e)}}setCurrentPath(e){this.loadFiles(e)}setSearchQuery(e){this.store.update(t=>({...t,searchQuery:e}))}setSortBy(e){this.store.update(t=>({...t,sortBy:e}))}setSortOrder(e){this.store.update(t=>({...t,sortOrder:e}))}setViewMode(e){this.store.update(t=>({...t,viewMode:e}))}selectItems(e){this.store.update(t=>({...t,selectedItems:e}))}toggleSelection(e){this.store.update(t=>({...t,selectedItems:t.selectedItems.includes(e)?t.selectedItems.filter(s=>s!==e):[...t.selectedItems,e]}))}clearSelection(){this.store.update(e=>({...e,selectedItems:[]}))}addToUploadQueue(e){this.uploadFiles(e)}removeFromUploadQueue(e){this.store.update(t=>({...t,uploadQueue:t.uploadQueue.filter(s=>s.id!==e)}))}clearUploadQueue(){this.store.update(e=>({...e,uploadQueue:[]}))}lockItems(e){return Promise.resolve()}unlockItems(e){return Promise.resolve()}validateFile(e){return e.size>104857600?{valid:!1,error:"File exceeds maximum size of 100MB"}:{valid:!0}}}const ve=new Ie,He=ve;export{De as C,qe as M,Ne as S,Ce as a,ie as b,Oe as c,We as d,Me as e,ze as f,ve as g,Be as h,Qe as i,xe as j,He as s};
